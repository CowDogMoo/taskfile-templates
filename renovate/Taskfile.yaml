---
version: "3"

tasks:
  renovate-docker-debug:
    desc: "Run Renovate in a Docker container with debugging enabled"
    cmds:
      - |
        docker run --rm -it \
          -e LOG_LEVEL=trace \
          -e RENOVATE_LOCAL_DIR="/tmp/renovate/repository" \
          -e RENOVATE_CONFIG_FILE="/usr/src/app/renovate.json5" \
          -e RENOVATE_DEBUG=true \
          -e RENOVATE_LOG_FILEFORMAT=true \
          -e RENOVATE_BASE_DIR="/tmp/renovate/repository" \
          -e RENOVATE_DEFAULT_BRANCH="main" \
          -e RENOVATE_GIT_AUTHOR="Renovate Bot <bot@renovateapp.com>" \
          -e RENOVATE_REPOSITORY_DIRTY=false \
          -v "${PWD}/.github/renovate.json5:/usr/src/app/renovate.json5" \
          -v "${PWD}:/tmp/renovate/repository" \
          -v "${PWD}/.cache:/tmp/renovate/cache" \
          --user=$(id -u):$(id -g) \
          renovate/renovate:39.11.4 \
          renovate \
          --platform=local \
          --dry-run=full \
          --base-dir="/tmp/renovate/repository" \
          --git-fs=true \
          --print-config=true | tee renovate-debug.log
